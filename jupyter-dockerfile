# Use the UBI 9 base image
FROM registry.access.redhat.com/ubi9/ubi:latest

# Install necessary dependencies
RUN dnf -y update && \
    dnf -y install gcc openssl-devel bzip2-devel libffi-devel zlib-devel wget make sqlite-devel python3-pip && \
    dnf clean all

# Download and extract Python source code
WORKDIR /usr/src/python
RUN wget https://www.python.org/ftp/python/3.10.0/Python-3.10.0.tgz && \
    tar -xf Python-3.10.0.tgz && \
    rm Python-3.10.0.tgz

# Build and install Pythony

WORKDIR /usr/src/python/Python-3.10.0
RUN ./configure --enable-optimizations && \
    make -j 4 && \
    make altinstall

# Clean up
WORKDIR /
RUN rm -rf /usr/src/python

# Install JupyterLab using pip3
RUN pip3.10 install jupyterlab

# Copy the JupyterLab configuration file
COPY jupyter_config.py /root/.jupyter/

# Set the default command to run JupyterLab
EXPOSE 8888
CMD ["jupyter", "lab", "--ip=0.0.0.0", "--port=8888", "--no-browser", "--allow-root"]
